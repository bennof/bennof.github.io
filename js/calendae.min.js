// Copyright 2018 Benjamin 'Benno' Falkner. All rights reserved.
// Use of this source code is governed by a MIT-style
// license that can be found in the LICENSE file.
var testdata=[{ID:2,Start:new Date("2018-04-02T03:24:00"),Title:"Event 1",Info:"Event 1 text info"},{ID:3,Start:new Date("2018-04-17T03:24:00"),Title:"Event 2",Info:"Event 2 text info"},{ID:4,Start:new Date("2018-05-21T03:24:00"),Title:"Event 3",Info:"Event 3 text info"},{ID:5,Start:new Date("2018-06-02T03:24:00"),Title:"Event 4",Info:"Event 4 text info"},{ID:6,Start:new Date("2018-07-17T03:24:00"),Title:"Event 5",Info:"Event 5 text info"},{ID:7,Start:new Date("2018-08-21T03:24:00"),Title:"Event 6",Info:"Event 6 text info"},{ID:8,Start:new Date("2018-09-02T03:24:00"),Title:"Event 7",Info:"Event 7 text info"},{ID:9,Start:new Date("2018-09-17T03:24:00"),Title:"Event 8",Info:"Event 8 text info"},{ID:10,Start:new Date("2018-10-21T03:24:00"),Title:"Event 9",Info:"Event 9 text info"}],Calendae={Cals:[],Close:'<i class="fa fa-times" aria-hidden="true"></i>',Calendar:'<i class="fa fa-calendar" aria-hidden="true"></i> Calendar',Locale:"de-DE",Event:"event-",Day:"day-",Cal:"cal-",Month:["January","February","March","April","May","June","July","August","September","October","November","December"],Day:["Mo","Tu","We","Th","Fr","Sa","So"],New:function(t,e,a){$.getJSON(e,function(e){$.each(e,function(t,e){e.Start=new Date(e.Start)});var n=new Calendar(t,e);a(n),Calendae.Cals.push(n)})}};function Calendar(t,e){this.Name=t,this.CalId="-"+Calendae.Cal+t,this.Event=this.CalId+"-"+Calendae.Event,this.Day=this.CalId+"-"+Calendae.Day,this.Date=new Date,this.data=e}Calendar.prototype.PopUp=function(t){var e=t.currentTarget.id.split("-");console.log(e[0]+e[4]),console.log(t.currentTarget.id),$("#popup-"+this.CalId).length||($(document.body).append('<div id="overlay-'+this.CalId+'" class="overlay"></div>             <div id="popup-'+this.CalId+'" class="popup">             <div class="right"><a id="'+this.CalId+'-closePopUp" href="#">'+Calendae.Close+'</a></div>             <div id="popupcontent"></div>             </div>'),$(document).on("click","#"+this.CalId+"-closePopUp",function(){console.log("#popup-"+this.CalId),$("#overlay-"+this.CalId).remove(),$("#popup-"+this.CalId).remove()}.bind(this))),"all"==e[4]?this.Calendar("popupcontent",new Date):this.Info("popupcontent",e[4])},Calendar.prototype.NextDates=function(t,e,a){this.Date=a;var n=$("#"+t);n.empty(),n.append('<p><button id="'+t+this.Event+'all" >'+Calendae.Calendar+"</button></p>"),n.off("click","#"+t+this.Event+"all"),n.on("click","#"+t+this.Event+"all",this.PopUp.bind(this));for(var i=0,l=0;l<this.data.length&&(a.getTime()<this.data[l].Start.getTime()&&(n.append('<p><div class="date">'+this.data[l].Start.toLocaleDateString(Calendae.Locale)+'</div> <a id="'+t+this.Event+l+'" href="#">'+this.data[l].Title+"</a></p>"),n.off("click","#"+t+this.Event+l),n.on("click","#"+t+this.Event+l,this.PopUp.bind(this)),i++),i!=e);l++);},Calendar.prototype.Info=function(t,e){$("#"+t).html("<h1>"+this.data[e].Title+"</h1>            <h6>"+this.data[e].Start.toLocaleDateString(Calendae.Locale)+"-"+this.data[e].End.toLocaleDateString(Calendae.Locale)+"</h6>            <h6>"+this.data[e].Location+"</h6>            <p>"+this.data[e].Info+"</p>")},Calendar.prototype.Calendar=function(t,e){this.Date=e,$("#"+t).html("<h1>"+Calendae.Calendar+'</h1>            <div id="'+t+this.CalId+'" class="calendar"></div>            <div id="'+t+this.CalId+'-info"></div>'),this.Render(t,e),$(document).off("click","#"+t+this.CalId+"-prev"),$(document).on("click","#"+t+this.CalId+"-prev",this.CalendarPrev.bind(this)),$(document).off("click","#"+t+this.CalId+"-next"),$(document).on("click","#"+t+this.CalId+"-next",this.CalendarNext.bind(this))},Calendar.prototype.CalendarPrev=function(t){var e=t.currentTarget.id.split("-")[0];this.Date=new Date(this.Date.getFullYear(),this.Date.getMonth()-1,1),this.Render(e,this.Date)},Calendar.prototype.CalendarNext=function(t){var e=t.currentTarget.id.split("-")[0];console.log(e),console.log(t.currentTarget.id),this.Date=new Date(this.Date.getFullYear(),this.Date.getMonth()+1,1),this.Render(e,this.Date)},Calendar.prototype.Render=function(t,e){var a=new Date,n=a.getFullYear()==e.getFullYear()&&a.getMonth()==e.getMonth(),i=new Date(e.getTime());i.setDate(1);var l=(i.getDay()+6)%7;i.setMonth(i.getMonth()+1),i.setDate(0);var o=i.getDate(),d='<ul class="head">             <li id="'+t+this.CalId+'-prev" class="prev">&#10094;</li>             <li id="'+t+this.CalId+'-next" class="next">&#10095;</li>             <li>'+Calendae.Month[e.getMonth()]+'<br>             <span style="font-size:14px">'+e.getFullYear()+"</span></li>             </ul>";d+='<ul class="weekdays">';for(var s=0;s<Calendae.Day.length;s++)d+="<li>"+Calendae.Day[s]+"</li>";d+="</ul>",d+='<ul class="days">';for(s=1;s<=l;s++)d+="<li></li>";var r=this.data,h=0;for(e.setHours(0,0,0,0),h=0;h<r.length&&!(e.getTime()<=r[h].Start.getTime());h++);for(s=1;s<=o;s++){e.setDate(s);var c="";h<r.length&&e.getFullYear()==r[h].Start.getFullYear()&&e.getMonth()==r[h].Start.getMonth()&&e.getDate()==r[h].Start.getDate()?(c='<a id="'+t+this.Event+h+'" href="#">'+s+"</a>",$(document).off("click","#"+t+this.Event+h),$(document).on("click","#"+t+this.Event+h,this.PopUp.bind(this)),h++):c=s,n&&s==a.getDate()?d+='<li class="active">'+c+"</li>":d+="<li>"+c+"</li>"}d+="</ul>",console.log("#"+t+this.CalId),$("#"+t+this.CalId).html(d)};
